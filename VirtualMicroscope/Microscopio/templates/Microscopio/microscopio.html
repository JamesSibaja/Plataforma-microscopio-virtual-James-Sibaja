<!-- se extiende la plantilla genérica-->
{% extends "generica.html" %}
{% block content %}
<div class="container" style="background-color:rgb(255, 255, 255);" style="width:100%;height: 100%" >
    <div class="separar"></div>  
<script type="text/javascript">
    $(document).ready(function() {
        var myButton = document.getElementById("myButton");
        var polygon = null;
        var polyLine = null;
        var polygonPoints = [];
        var polygonDraw  = false;
        var i = "{{slide.path}}";
        var h = "{{slide.zoomI}}";
        var j = "{{slide.zoomM}}";
        var slide_url_format = "/media/slides/"+i+"/{z}/{y}/{x}.jpg";

       var imageBounds = L.latLngBounds(
        L.latLng(-62, -115),  // Coordenadas del borde inferior izquierdo
        L.latLng(62, 115)   // Coordenadas del borde superior derecho
        );

       var map = L.map('map').fitBounds(imageBounds, {
           center: [0,0],
           zoom: h,
           animate: true
       });

       var layer =  L.tileLayer(slide_url_format, {
           minZoom:2,
           noWrap: true,
           keepBuffer:8,
           maxZoom:j
       }).addTo(map);
      
       var pos = map.getBounds();
       var popup = L.popup();

       map.setMaxBounds(imageBounds);

       function updatePolygon() {
            if (polygon) {
                map.removeLayer(polygon);
                
            }

            if (polyLine){
                map.removeLayer(polyLine);
            }
            
            if (polygonPoints.length > 2) {
                
                if(polygonDraw){
                    polyLine = L.polyline(polygonPoints, { color: 'Red' }).addTo(map);
                }else{
                    polygon = L.polygon(polygonPoints, { color: 'blue', fillOpacity: 0.2 }).addTo(map);
                }
            }else{
                if (polygonPoints.length > 1 ) {
                    polygon = L.polyline(polygonPoints, { color: 'Red' }).addTo(map);
                }else{
                    if (polygonPoints.length > 0 ) {
                        polygon = L.circleMarker(polygonPoints[0], { color: 'red',fillOpacity: 0,radius: 2 }).addTo(map);
                    }
                }
            }
        }
      
       function onMapClick(e) {
            if(polygonDraw){
                polygonPoints.push([e.latlng.lat, e.latlng.lng]);
            }
            updatePolygon();
            // pos = map.getBounds();
            // popup
            //     .setLatLng(e.latlng)
            //     .setContent("Ver" )
            //     .openOn(map);
            
        }

        var mapContainer = map.getContainer();
        mapContainer.addEventListener('mouseenter', function() {
            if(polygonDraw){
                mapContainer.classList.add('custom-cursor');
            }
        });
        mapContainer.addEventListener('mouseleave', function() {
            if(polygonDraw){
                mapContainer.classList.remove('custom-cursor');
            }
        });

       
        // map.on('click', onMapClick);
        // $('#MyButton').click(function(){
        //     map.fitBounds(pos)
        // });

        map.on('click', onMapClick);
        $('#myPolygon').click(function(){
            polygonDraw = !polygonDraw ;
            if(polygonDraw){
                polygonPoints = [];
            }
            updatePolygon();
        });
        
        var myPolygon = document.getElementById("myPolygon");
            myPolygon.addEventListener("click", function() {
            myPolygon.classList.toggle("active");
        });

        map.on('zoomstart', function () {
            map.setMaxBounds(null);
        });

        // Restablecer los límites cuando finaliza el zoom
        map.on('zoomend', function () {
            map.setMaxBounds(imageBounds);
        });

       }
      );
    
       
   

</script>
<div id="map" style="background-color:rgb(0, 0, 0);box-shadow: 1px 1px 10px rgb(100, 99, 99); top:3rem;left: 5% ;border-radius:10px;width:90%;height: 70%"></div>   

<button style="position: relative;top: 10%;left: 30%;" class="btn btn-primary js-tooltip" type="submit" onclick="location.href='{{ slide.getAbsoluteUrl }}'">Pantalla Completa</button>  
<input id="myPolygon" style="position: relative;top: 10%;left: 30%;" class="btn btn-outline-success js-tooltip" type="button" value="Dibujar Poligono" >
<button style="position: relative;top: 10%;left: 30%;" class="btn btn-dark js-tooltip" type="submit" onclick="location.href='{% url 'Catalogo' %}'">Retroceder</button>

</div>

<style>

    #map.custom-cursor {
      cursor: crosshair; /* Estilo de cursor personalizado */
    }
  </style>

{% endblock %}


